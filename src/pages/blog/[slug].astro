---
import BaseLayout from "../../layout/BaseLayout.astro";
import "../style/markdown.css";
//
import { getPostById } from "../../api/getPostById";
import { getPosts } from "../../api/getPosts";
//
import { markedReadContent } from "../../utils/marked";
import { formatDate } from "../../utils/date";
import { calculateReadingTime } from "../../utils/readingTime";
//

export const getStaticPaths = async () => {
  const posts = await getPosts();

  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
};

const { slug } = Astro.params;
const post = await getPostById(slug);
const pageTitle = post ? post.title : "Post Not Found";

const parsedContent = post ? markedReadContent(post.content) : "";
---

<BaseLayout>
  <!-- <BaseLayout pageTitle={pageTitle}> -->
  <div class="post-detail">
    <div class="info">
      <div class="title">
        {post.title}
      </div>
      <div class="tags">
        {post.tags.map((tag: string) => <div class="tag">{tag}</div>)}
      </div>
      <div class="time-info">
        <div class="created-at">{formatDate(post.created_at)}</div>
        <div class="bullet">â€¢</div>
        <div class="reading-time">
          {calculateReadingTime(post.content)} min read
        </div>
      </div>
    </div>
    <!-- <div class="divider"></div> -->

    <div class="content" set:html={parsedContent} />
  </div>
</BaseLayout>

<style>
  .post-detail {
    max-width: 800px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 48px;
    margin-top: 48px;
  }

  .title {
    font-size: 40px;
    font-weight: 700;
  }

  .info {
    display: flex;
    flex-direction: column;
    gap: 24px;
    /* margin-bottom: 48px; */

    .tags {
      display: flex;
      gap: 8px;

      .tag {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 4px 8px;
        background-color: #525252;
        border-radius: 100px;
        font-size: 14px;
      }
    }

    .time-info {
      display: flex;
      flex-direction: row;
      gap: 8px;
      .created-at {
        font-style: italic;
      }
    }
  }

  .divider {
    width: 100%;
    height: 1px;
    background-color: #525252;
  }
</style>
